{% extends "common/base.html" %}
{% load i18n %}
{% load bbcode_tags %}
{% bbcode entry.bbcode_content %}

{% block title %}
    {{ package }} - version {{ current_release.version }}
{% endblock title %}

{% block content %}

    <body>

        {% if package.logo %}
            <img src="{{ MEDIA_URL }}{{ package.logo }}" height="135" width="135" alt="{{ package }} Logo"/>
        {% endif %}
        <h1>{{ package }} - version {{ current_release.version }}</h1>
        {# TODO: only show this if the logged in user is the owner or a contributor #}
        <ul>
            <b><a href="{% url 'packages:edit' slug=package.slug %}">Edit Page</a></b> |
            <b><a href="{% url 'packages:update' slug=package.slug %}">Update Package</a></b> |
            <b><a href="{% url 'packages:select-games' slug=package.slug %}">Select games</a></b>
        </ul>

        <h4><a href="{{ current_release.get_absolute_url }}"><u>Download current version</u></a> &nbsp; <span style="font-size: small;">( <a href="{% url 'packages:releases' slug=package.slug %}"><u>View all releases</u></a> )</span></h4>

        {% if package.synopsis %}
            <br />
            {{ package.synopsis }}
            <br />
        {% endif %}

        <br />
        <p>Created on {{ package.datetime_created }}</p>
        {% if package.datetime_last_updated %}
            <p>Last updated on {{ package.datetime_last_updated }}</p>
        {% endif %}

        <br />
        <ul>
            <div class="row">
                <div class="col-sm-12">
                    <div class="panel panel-primary panel-primary-custom">
                        <div class="panel-heading panel-heading-custom">
                            <h3 class="panel-title">Owner</h3>
                        </div>
                        <table class="table">
                            <tbody>
                                <tr>
                                    <td><a href="{{ package.owner.get_absolute_url }}">{{ package.owner }}</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <br />
            <div class="row">
                <div class="col-sm-12">
                    <div class="panel panel-primary panel-primary-custom">
                        <div class="panel-heading panel-heading-custom">
                            <h3 class="panel-title">Contributors</h3>
                            {#  TODO: only show this if the user is logged in and is the owner #}
                            <span class="pull-right" style="margin-top: -20px">
                                <a href="{% url 'packages:add_contributor' slug=package.slug %}">
                                    <button type="button" class="btn btn-xs btn-default">Add Contributor</button>
                                </a>
                            </span>
                        </div>
                        <table class="table table-striped">
                            <tbody>
                                {% for contributor in contributors %}
                                    <tr>
                                        <td><a href="{{ contributor.get_absolute_url }}">{{ contributor }}</a></td>
                                        {# TODO: add the delete button.  only show if the user is the owner #}
                                        <td class="text-right">
        {#                                    <a data-toggle="modal" href="#{{  }}"#}
                                        </td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="2" class="text-center">There are no contributors</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </ul>

        {% if supported_games %}
            <h3>Supported Games</h3>
            <ul>
                {% for game in supported_games %}
                    <a href="{% url 'games:detail' slug=game.slug %}"><img src="{{ MEDIA_URL }}{{ game.icon }}" style="margin-right: -14px;" alt="{{ game }} Icon"/></a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                {% endfor %}
            </ul>
        {% endif %}

        {% if package.description.rendered %}
            <h3>Description</h3>
            <ol>
                {{ package.description.rendered }}
            </ol>
            <br />
        {% endif %}

        <h3>Installation</h3>
        <ol>
            <li>Download the zip file.</li>
            <li>Extract the zip file to your server's primary directory (ie <span style="color: blue">../my_servers/css/cstrike/</span>).</li>
        </ol>
        <br />

        {% if package.configuration.rendered %}
            <h3>Configuration</h3>
            <ol>
                {{ package.configuration.rendered }}
            </ol>
            <br />
        {% endif %}

        <p>As this is a package, you cannot simply load it.  Plugins, Sub-Plugins, and even other Packages may utilize this package by importing it in their code.</p>

        {% if package_requirements or pypi_requirements %}
            <h3>Requirements</h3>

            <ul>
                {% if package_requirements %}
                    <br />
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-primary panel-primary-custom">
                                <div class="panel-heading panel-heading-custom">
                                    <h3 class="panel-title">Package Requirements</h3>
                                </div>
                                <table class="table">
                                    <tbody>
                                        {% for package_requirement in package_requirements %}
                                            <tr>
                                                <td><a href="{% url 'packages:detail' slug=package_requirement.slug %}">{{ package_requirement }}</a></td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endif %}

                {% if pypi_requirements %}
                    <br />
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-primary panel-primary-custom">
                                <div class="panel-heading panel-heading-custom">
                                    <h3 class="panel-title">PyPi Requirements</h3>
                                </div>
                                <table class="table">
                                    <tbody>
                                        {% for pypi_requirement in pypi_requirements %}
                                            <tr>
                                                <td><a href="{% url 'pypi:detail' slug=pypi_requirement.slug %}">{{ pypi_requirement }}</a></td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </ul>
        {% endif %}

        {% if required_in_plugins or required_in_sub_plugins or required_in_packages %}
            <h3>Usage Lists</h3>
            <ul>
                {% if required_in_plugins %}
                    <br />
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-primary panel-primary-custom">
                                <div class="panel-heading panel-heading-custom">
                                    <h3 class="panel-title">Plugins that require {{ package }}</h3>
                                </div>
                                <table class="table">
                                    <tbody>
                                        {% for group in required_in_plugins %}
                                            <tr>
                                                {% for plugin in group %}
                                                    {% if plugin %}
                                                        <td><a href="{% url 'plugins:detail' slug=plugin.slug %}">{{ plugin }}</a></td>
                                                    {% endif %}
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endif %}

                {% if required_in_sub_plugins %}
                    <br />
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-primary panel-primary-custom">
                                <div class="panel-heading panel-heading-custom">
                                    <h3 class="panel-title">Sub-Plugins that require {{ package }}</h3>
                                </div>
                                <table class="table">
                                    <tbody>
                                        {% for group in required_in_sub_plugins %}
                                            <tr>
                                                {% for sub_plugin in group %}
                                                    {% if sub_plugin %}
                                                        <td><a href="{% url 'plugins:sub_plugins:detail' slug=sub_plugin.plugin.slug sub_plugin_slug=sub_plugin.slug %}">{{ sub_plugin }}</a></td>
                                                    {% endif %}
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endif %}

                {% if required_in_packages %}
                    <br />
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="panel panel-primary panel-primary-custom">
                                <div class="panel-heading panel-heading-custom">
                                    <h3 class="panel-title">Packages that require {{ package }}</h3>
                                </div>
                                <table class="table">
                                    <tbody>
                                        {% for group in required_in_packages %}
                                            <tr>
                                                {% for other in group %}
                                                    {% if other %}
                                                        <td><a href="{% url 'packages:detail' slug=other.slug %}">{{ other }}</a></td>
                                                    {% endif %}
                                                {% endfor %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </ul>
        {% endif %}

    </body>

{% endblock content %}
